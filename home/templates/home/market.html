{% load humanize %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>클린컬리</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'HOME_마켓.css' %}">
    <link rel="stylesheet" href="{% static 'base.css' %}">
</head>
<body>
    <!-- haeder 수정 -->
    {% include 'common/header.html' %}

    <!-- 메인 이벤트 섹션 -->
    <section class="event">
        <h2 class="a11yHidden">메인 이벤트</h2>
        <div class="event__wrapper">
            <img src="{% static 'images/컬리배너1.png' %}" alt="새학기를 위한 스타일 빈폴키즈 스쿨룩" class="event__image active" id="banner1">
            <img src="{% static 'images/컬리배너2.png' %}" alt="명절엔 꼬까옷 입어요 어린이 한복 추천" class="event__image" id="banner2">
            <img src="{% static 'images/컬리배너3.png' %}" alt="함께 즐기기 좋은 간편식 총집합" class="event__image" id="banner3">
            <img src="{% static 'images/컬리배너4.jpg' %}" alt="선물하기 좋은 리빙 위시리스트" class="event__image" id="banner4">
            <img src="{% static 'images/컬리배너5.jpg' %}" alt="언제, 어디서든 컬리카드 적립 생활" class="event__image" id="banner5">
            <img src="{% static 'images/컬리배너6.jpg' %}" alt="말랑 쫀득 달콤 절정의 황도 즐기기" class="event__image" id="banner6">

            <button type="button" class="button__left" aria-label="왼쪽 이벤트 페이지로 이동" onclick="showPreviousBanner()">
                <img src="{% static 'images/화살표오른쪽.svg' %}" alt="왼쪽 이동 화살표">
            </button>
            <button type="button" class="button__right" aria-label="오른쪽 이벤트 페이지로 이동" onclick="showNextBanner()">
                <img src="{% static 'images/화살표왼쪽.svg' %}" alt="오른쪽 이동 화살표">
            </button>
        </div>
    </section>


    <script>
        let currentBanner = 1;
        const totalBanners = 6; // 전체 배너의 수

        setInterval(showNextBanner, 3000); //해당 시간 지난 후 다음 배너로
    
        function showNextBanner() {
            const current = document.getElementById(`banner${currentBanner}`);
            current.classList.remove('active');
    
            currentBanner = (currentBanner % totalBanners) + 1; // 1에서 totalBanners까지 순환
    
            const next = document.getElementById(`banner${currentBanner}`);
            next.classList.add('active');
        }
    
        function showPreviousBanner() {
            const current = document.getElementById(`banner${currentBanner}`);
            current.classList.remove('active');
    
            currentBanner = (currentBanner === 1 ? totalBanners : currentBanner - 1); // 1에서 totalBanners까지 순환
    
            const previous = document.getElementById(`banner${currentBanner}`);
            previous.classList.add('active');
        }
    </script>

    <!-- 상품 슬라이더 HTML -->
    <section class="goodsUp">
        <br>
        <h2 class="goods__title">🛒이 상품 어때요?</h2>
        <br>

        <div class="slider-container">
            <!-- 이전 버튼 -->

            <div class="slider">
                {% for product in products %}
                <div class="goods__list">
                    <a href="{% url 'shop:product_detail' product.id %}" class="goods__link" title="{{ product.name }} 상세페이지">
                        <dl class="goods__item goods__discount">
                            <dd class="goods__thumbnail">
                                <img src="{{ product.image.url }}" alt="{{ product.name }} 이미지" aria-hidden="true">
                            </dd>
                        </dl>
                    </a>

                    <!-- 모달창 -->

                    <button type="button" class="button__cart" onclick="openModal('{{ product.name }}', '{{ product.image.url }}', '{{ product.price|floatformat:0|intcomma }}')" aria-label="장바구니로 이동">
                        🛒 담기
                    </button>
                    <div id="modal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <h2>상품 상세 정보</h2>
                            <p>지금 테스트 중입니다.</p>
                        </div>
                    </div>

                    <script>
                        // 모달 열기
                        function openModal() {
                            const modal = document.getElementById("modal");
                            modal.style.display = "flex"; // 모달을 화면에 표시
                        }

                        // 모달 닫기
                        function closeModal() {
                            const modal = document.getElementById("modal");
                            modal.style.display = "none"; // 모달을 화면에서 숨김
                        }
                    </script>

                    <a href="{% url 'shop:product_detail' product.id %}" class="goods__link" title="{{ product.name }} 상세페이지">
                        <dl class="goods__item goods__discount">
                            <dd class="goods__name">{{ product.name }}</dd>
                            {% if product.discount_price %}
                                <dt class="a11yHidden">정상가</dt>
                                <dd class="goods__regPrice"><del>{{ product.price|floatformat:0|intcomma }} 원</del></dd>
                                <dt class="a11yHidden">할인가</dt>
                                <dd class="goods__disPrice">
                                    <b class="goods__disRate">{{ product.discount_percentage }}% </b>
                                    <ins>{{ product.discount_price|floatformat:0|intcomma }} 원</ins>
                                </dd>
                            {% else %}
                                <dd class="goods__disPrice">
                                    <ins>{{ product.price|floatformat:0|intcomma }} 원</ins>
                                </dd>
                            {% endif %}
                        </dl>
                    </a>
                </div>
                {% endfor %}
            </div>
            <button class="prev-btn2" aria-label="이전 상품으로 이동">
                <img src="{% static 'images/화살표왼쪽.svg' %}" alt="이전 화살표">
            </button>
            <!-- 다음 버튼 -->
            <button class="next-btn2" aria-label="다음 상품으로 이동">
                <img src="{% static 'images/화살표오른쪽.svg' %}" alt="다음 화살표">
            </button>
        </div>
    </section>

    <script>
        const slider = document.querySelector('.slider');
        const prevBtn = document.querySelector('.prev-btn2');
        const nextBtn = document.querySelector('.next-btn2');

        let currentPage = 1;  // 현재 페이지 번호
        const totalItems = 8;  // 총 상품 수
        const itemsPerPage = 4;  // 한 페이지에 보여줄 상품 수
        const totalPages = Math.ceil(totalItems / itemsPerPage);  // 총 페이지 수 계산

        // 각 상품의 너비 (이미지 크기 + 간격)
        const itemWidth = 280 + 20;  // 상품 너비 + 간격(20px)

        // 슬라이더 전체 너비 설정 (상품 너비 * 총 상품 개수)
        slider.style.width = `${itemWidth * totalItems}px`;

        // 다음 버튼 클릭 시 상품 부드럽게 넘기기
        function showNextPage() {
            if (currentPage < totalPages) {
                currentPage++;  // 다음 페이지로 이동
            } else {
                currentPage = 1;  // 마지막 페이지에서 첫 번째로 돌아감
            }

            const offset = -(currentPage - 1) * itemWidth * itemsPerPage;  // 슬라이더의 너비만큼 이동
            slider.style.transform = `translateX(${offset}px)`;  // 가로로 슬라이더 이동
        }

        // 이전 버튼 클릭 시 상품 부드럽게 넘기기
        function showPreviousPage() {
            if (currentPage > 1) {
                currentPage--;  // 이전 페이지로 이동
            } else {
                currentPage = totalPages;  // 첫 번째 페이지에서 마지막 페이지로
            }

            const offset = -(currentPage - 1) * itemWidth * itemsPerPage;  // 슬라이더의 너비만큼 이동
            slider.style.transform = `translateX(${offset}px)`;  // 가로로 슬라이더 이동
        }

        // 버튼에 이벤트 핸들러 연결
        nextBtn.addEventListener('click', showNextPage);
        prevBtn.addEventListener('click', showPreviousPage);

    </script>
    
    <section class="special-offers">
        <h2 class="special-offers__title">&#127873; 선물특가</h2>
        <div class="special-offers__container">
            <div class="special-offers__left">
                <div class="special-offers__timer">
                    <div class="special-offers__timer-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" width="20" height="20" preserveAspectRatio="xMidYMid meet">
                            <circle cx="18" cy="18" r="14" fill="rgb(189,118,255)" />
                            <!-- 시침-->
                            <line x1="18" y1="18" x2="18" y2="10" stroke="rgb(255,255,255)" stroke-width="2" stroke-linecap="round" />
                            <!-- 분침 -->
                            <line x1="18" y1="18" x2="26" y2="18" stroke="rgb(255,255,255)" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </div>
                    <div class="special-offers__timer-countdown" id="countdown">
                        <p>00:00:00</p> <!-- 초기 타이머 표시 -->
                    </div>
                </div>
                <br>
                <p class="small-gray-text">망설이면 늦어요!</p>
            </div>
            <div class="special-offers__right">
                <!-- 첫 번째 상품 -->
                <div class="special-offers__product">
                    <a href="#" class="special-offers__link" title="[선물세트] HBAF 매일 상품페이지">
                        <dl class="special-offers__product-item special-offers__discount">
                            <dd class="special-offers__product-thumbnail">
                                <img src="{% static 'images/hbaf.jpg' %}" alt="상품 이미지" aria-hidden="true">
                            </dd>
                            <button type="button" class="special-offers__button-cart" aria-label="장바구니로 이동">
                                🛒 담기
                            </button>
                            <dd class="special-offers__product-name">
                                <span aria-hidden="true">[주말특가][</span>선물세트<span aria-hidden="true">]</span> HBAF 매일 색다른 먼투썬 하루견과 6주 (20gX42봉)
                            </dd>
                            <dt class="a11yHidden">정상가</dt>
                            <dd class="special-offers__product-regPrice">
                                <del>34,900 원</del>
                            </dd>
                            <dt class="a11yHidden">할인가</dt>
                            <dd class="special-offers__product-disPrice">
                                <b class="special-offers__product-disRate">20%</b>
                                <ins>27,900 원</ins>
                            </dd>
                        </dl>
                    </a>
                </div>
                <!-- 두 번째 상품 -->
                <div class="special-offers__product">
                    <a href="#" class="special-offers__link" title="[선물세트] 설렁탕 상세페이지">
                        <dl class="special-offers__product-item special-offers__discount">
                            <dd class="special-offers__product-thumbnail">
                                <img src="{% static 'images/설렁탕.jpg' %}" alt="상품 이미지" aria-hidden="true">
                            </dd>
                            <button type="button" class="special-offers__button-cart" aria-label="장바구니로 이동">
                                🛒 담기
                            </button>
                            <dd class="special-offers__product-name">
                                <span aria-hidden="true">[주말특가][</span>선물세트<span aria-hidden="true">]</span> 신선설농탕 고기 설렁탕6입 세트
                            </dd>
                            <dt class="a11yHidden">정상가</dt>
                            <dd class="special-offers__product-regPrice">
                                <del>46,000 원</del>
                            </dd>
                            <dt class="a11yHidden">할인가</dt>
                            <dd class="special-offers__product-disPrice">
                                <b class="special-offers__product-disRate">20%</b>
                                <ins>36,800 원</ins>
                            </dd>
                        </dl>
                    </a>
                </div>
            </div>
        </div>
    </section>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            function updateCountdown(endTime) {
                const now = new Date();
                const timeRemaining = endTime - now;
                
                // 만약 시간이 이미 지났다면 종료
                if (timeRemaining <= 0) {
                    document.querySelector("#countdown p").textContent = '00:00:00';
                    return;
                }
                
                const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
    
                // '일'을 조건부로 출력
                const dayString = days > 0 ? `${days}일 ` : '';
                document.querySelector("#countdown p").textContent =
                    `${dayString}${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }
    
            // 로컬 스토리지에서 종료 시간 불러오기
            let endTime = localStorage.getItem("endTime");
            
            // 종료 시간이 없거나 이미 종료된 경우 새로 설정
            if (!endTime || new Date(endTime) - new Date() <= 0) {
                endTime = new Date();
                endTime.setMinutes(endTime.getMinutes() + 120);
                localStorage.setItem("endTime", endTime); // 종료 시간을 로컬 스토리지에 저장
            } else {
                endTime = new Date(endTime);
            }
    
            // 1초마다 카운트다운 업데이트
            setInterval(() => updateCountdown(endTime), 1000);
        });

                
    </script>

   <br>
        <!-- banner -->    
        <section class="banner">        
            <div class="banner_container">    
                <a href="#" class="banner_link"> 
                    <img 
                        src="{% static 'images/미니 배너1.jpg' %}"
                        alt="배너 이미지" 
                        class="banner_image" 
                        style="object-fit: cover; width: 100%; height: 100%;">
                </a>
            </div>
        </section>


    <!--향은: 두 번째 섹션 부분은 상품 등록 안하고 일단 이렇게 냅둘게요!!!-->
    <br>
        <!-- 두 번째 섹션 추가 -->
    <section class="goodsUp">
        <br>
        <!-- 상품2 제목 -->
        <h2 class="goods__title">&#127765; 최대 혜택으로 추석 맞이! 🍂</h2>
        <br>
        <!-- 상품2 목록 -->
        <div class="goods__group">
            <!-- 첫번째 요소 -->
            <div class="goods__list">
                <a href="#" class="goods__link" title="[선물세트] 호주산 LA꽃갈비 상세페이지">
                    <dl class="goods__item goods__discount">
                        <dd class="goods__thumbnail">
                            <img src="{% static 'images/꽃갈비.jpg' %}" alt="상품 이미지" aria-hidden="true">
                        </dd>
                        <button type="button" class="button__cart" aria-label="장바구니로 이동">
                            🛒 담기
                        </button>
                        <dd class="goods__name">
                            <span aria-hidden="true">[</span>선물세트<span aria-hidden="true">]</span> 호주산 LA꽃갈비 2kg(냉동) (예약일 수령)
                        </dd>
                        <dt class="a11yHidden">정상가</dt>
                        <dd class="goods__regPrice"><del>139,900 원</del></dd>
                        <dt class="a11yHidden">할인가</dt>
                        <dd class="goods__disPrice">
                            <b class="goods__disRate">24%</b>
                            <ins>104,990 원</ins>
                        </dd>
                    </dl>
                </a>
            </div>

            <!-- 두번째 요소 -->
            <div class="goods__list">
                <a href="#" class="goods__link" title="[선물세트] 공진단 상세페이지">
                    <dl class="goods__item goods__discount">
                        <dd class="goods__thumbnail">
                            <img src="{% static 'images/공진단.jpg' %}" alt="상품 이미지" aria-hidden="true">
                        </dd>
                        <button type="button" class="button__cart" aria-label="장바구니로 이동">
                            🛒 담기
                        </button>
                        <dd class="goods__name">
                            <span aria-hidden="true">[</span>선물세트<span aria-hidden="true">]</span> 혜윰 별빛공진 +(보자기포장 및 쇼핑백 증정)
                        </dd>
                        <dt class="a11yHidden">정상가</dt>
                        <dd class="goods__regPrice"><del>160,000 원</del></dd>
                        <dt class="a11yHidden">할인가</dt>
                        <dd class="goods__disPrice">
                            <b class="goods__disRate">35%</b>
                            <ins>104,000 원</ins>
                        </dd>
                    </dl>
                </a>
            </div>
            

            <!-- 세번째 요소 -->
            <div class="goods__list">
                <a href="#" class="goods__link" title="[정관장] 홍삼정 에브리타임 상세페이지">
                    <dl class="goods__item goods__discount">
                        <dd class="goods__thumbnail">
                            <img src="{% static 'images/정관장.jpg' %}" alt="상품 이미지" aria-hidden="true">
                        </dd>
                        <button type="button" class="button__cart" aria-label="장바구니로 이동">
                            🛒 담기
                        </button>
                        <dd class="goods__name">
                            <span aria-hidden="true">[</span>정관장<span aria-hidden="true">]</span> 홍삼정 에브리타임 소프트 (30일분) (+보자기포장)
                        </dd>
                        <dt class="a11yHidden">정상가</dt>
                        <dd class="goods__regPrice"><del>77,000 원</del></dd>
                        <dt class="a11yHidden">할인가</dt>
                        <dd class="goods__disPrice">
                            <b class="goods__disRate">10%</b>
                            <ins>69,300 원</ins>
                        </dd>
                    </dl>
                </a>
            </div>
            

            <!-- 네번째 요소 -->
            <div class="goods__list">
                <a href="#" class="goods__link" title="[비오템] 아쿠아 파워 올인원 상세페이지">
                    <dl class="goods__item goods__discount">
                        <dd class="goods__thumbnail">
                            <img src="{% static 'images/올인원.jpg' %}" alt="상품 이미지" aria-hidden="true">
                        </dd>
                        <button type="button" class="button__cart" aria-label="장바구니로 이동">
                            🛒 담기
                        </button>
                        <dd class="goods__name">
                            <span aria-hidden="true">[</span>비오템<span aria-hidden="true">]</span> 아쿠아 파워 올인원 200ml 추석 선물세트
                        </dd>
                        <dt class="a11yHidden">정상가</dt>
                        <dd class="goods__regPrice">
                            <del>62,000 원</del>
                        </dd>
                        <dt class="a11yHidden">할인가</dt>
                        <dd class="goods__disPrice">
                            <b class="goods__disRate">15%</b>
                            <ins>52,700 원</ins>
                        </dd>
                    </dl>
                </a>
            </div>
    </section>
    <br>

    {% include 'common/footer.html' %}
</body>
</html>
